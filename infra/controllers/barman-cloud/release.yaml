# HelmRelease for the Barman Cloud Plugin for CloudNativePG.
# This installs the CNPG-I plugin that implements WAL archiving and base backups
# via Barman Cloud (S3-compatible object stores), replacing the now-deprecated
# in-tree barmanObjectStore field on Cluster resources (deprecated in CNPG 1.26).
#
# Chart: plugin-barman-cloud v0.5.0 â†’ appVersion v0.11.0
# Repo:  https://cloudnative-pg.github.io/charts
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: barman-cloud
  namespace: cnpg-system
spec:
  interval: 30m
  chart:
    spec:
      # Chart name in the cloudnative-pg Helm repo
      chart: plugin-barman-cloud
      version: "0.5.0"
      sourceRef:
        kind: HelmRepository
        # Reuse the existing HelmRepository installed by infra/controllers/cnpg/
        name: cnpg
        namespace: cnpg-system
      interval: 12h
  driftDetection:
    mode: enabled
